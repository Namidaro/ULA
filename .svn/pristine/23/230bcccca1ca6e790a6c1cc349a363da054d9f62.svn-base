<UserControl
    x:Class="ULA.Devices.Presentation.View.SchemeModeRuntimeView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters1="clr-namespace:ULA.Presentation.SharedResourses.Converters;assembly=ULA.Presentation.SharedResourses"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:userControl1="clr-namespace:ULA.Presentation.Infrastructure.ViewModels.UserControl;assembly=ULA.Presentation.Infrastructure"
    xmlns:converters="clr-namespace:ULA.Devices.Presentation.Converters"
    xmlns:view="clr-namespace:ULA.Devices.Presentation.View"
    xmlns:factories="clr-namespace:ULA.AddinsHost.ViewModel.Factories;assembly=ULA.AddinsHost"
    xmlns:runtime="clr-namespace:ULA.Devices.Presentation.Runtime"
    xmlns:customItems="clr-namespace:ULA.Devices.Presentation.Runtime.CustomItems"
    xmlns:outgoingLines="clr-namespace:ULA.Devices.Presentation.Runtime.OutgoingLines"
    d:DesignHeight="700"
    d:DesignWidth="1000"
    Background="{StaticResource MainBackground}"
    mc:Ignorable="d">
    <UserControl.Resources>
        <BooleanToVisibilityConverter   x:Key="BoolToVisibilityConverter" />
        <converters1:ObjectAsBoolToHiddenVisibilityConverter  x:Key="ObjectAsBoolToHiddenVisibilityConverter" />
        <converters1:ObjectAsBoolToVisibilityRevertConverter  x:Key="ObjectAsBoolToVisibilityRevertConverter" />

        <converters1:ResistorsCheckBoxVisibilityConverter x:Key="ResistorsCheckBoxVisibilityConverter" />
        <converters1:EnumStatesToInverseBrushConverter x:Key="EnumStatesToInverseBrushConverter" />
        <converters:AnalogMeterToVisSchemeConverter x:Key="AnalogMeterToVisSchemeConverter" />
        <converters:AnalogMeterToTextSchemeConverter x:Key="AnalogMeterToTextSchemeConverter" />
        <converters1:EnumStatesToBrushConverter x:Key="EnumStatesToBrushConverter" />
        <converters1:BoolToTextConverter x:Key="EnumStatesToTextConverter" />
        <converters1:ObjAsBoolToStateBrushRevert x:Key="ObjAsBoolToStateBrushRevert" />
        <converters1:ObjAsBoolToStateBrush x:Key="ObjAsBoolToStateBrush" />
        <converters1:ObjAsBoolToStateLimeBrush x:Key="objAsBoolToStateLimeBrush" />
        <converters1:IsNullToVisibilityConverter x:Key="isNullToVisibilityConverter"></converters1:IsNullToVisibilityConverter>
    </UserControl.Resources>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1*" />
            <ColumnDefinition Width="4*" />
            <ColumnDefinition Width="0.8*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="20" />
            <RowDefinition Height="1*" />
        </Grid.RowDefinitions>

        <!--  указатель назад и Имя схемы устройства  -->
        <StackPanel
            Grid.Row="0"
            Grid.Column="0"
            Grid.ColumnSpan="2"
            Orientation="Horizontal">

            <!--  Кнопка назад  -->
            <Viewbox Stretch="Fill">
                <Button
                    Command="{Binding BackToListWidgetCommand}"
                    SnapsToDevicePixels="True"
                    Style="{DynamicResource arrowBack}">
                    <Button.Resources>
                        <Style x:Key="arrowBack" TargetType="{x:Type Button}">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="{x:Type Button}">
                                        <Grid>
                                            <Viewbox>
                                                <Grid>
                                                    <Path
                                                        x:Name="arrowTop"
                                                        Width="262"
                                                        Height="198"
                                                        Data="F1 M 48.5143,170L 144.514,73.9999L 195.514,74L 121.515,150L 304.514,150L 304.514,190L 121.514,190L 195.514,266L 144.514,266L 48.5143,170 Z "
                                                        Fill="#FFF"
                                                        RenderTransformOrigin="0.5,0.5"
                                                        Stretch="Fill"
                                                        Stroke="#FFFF"
                                                        StrokeEndLineCap="Round"
                                                        StrokeLineJoin="Round"
                                                        StrokeStartLineCap="Round"
                                                        StrokeThickness="6">
                                                        <Path.RenderTransform>
                                                            <TransformGroup>
                                                                <ScaleTransform ScaleX="0.7" ScaleY="0.7" />
                                                                <SkewTransform />
                                                                <RotateTransform />
                                                                <TranslateTransform />
                                                            </TransformGroup>
                                                        </Path.RenderTransform>
                                                    </Path>
                                                    <Ellipse
                                                        x:Name="ellipse"
                                                        Width="340"
                                                        Height="340"
                                                        Fill="{DynamicResource Accent}"
                                                        Opacity=".6"
                                                        Stretch="Fill"
                                                        Stroke="#FFFFFF"
                                                        StrokeLineJoin="Round"
                                                        StrokeThickness="15" />
                                                    <Path
                                                        x:Name="arrow"
                                                        Width="262"
                                                        Height="198"
                                                        Data="F1 M 48.5143,170L 144.514,73.9999L 195.514,74L 121.515,150L 304.514,150L 304.514,190L 121.514,190L 195.514,266L 144.514,266L 48.5143,170 Z "
                                                        Fill="White"
                                                        RenderTransformOrigin="0.5,0.5"
                                                        Stretch="Fill"
                                                        Stroke="#FFFF"
                                                        StrokeEndLineCap="Round"
                                                        StrokeLineJoin="Round"
                                                        StrokeStartLineCap="Round"
                                                        StrokeThickness="6">
                                                        <Path.RenderTransform>
                                                            <TransformGroup>
                                                                <ScaleTransform ScaleX="0.7" ScaleY="0.7" />
                                                                <SkewTransform />
                                                                <RotateTransform />
                                                                <TranslateTransform />
                                                            </TransformGroup>
                                                        </Path.RenderTransform>
                                                    </Path>

                                                </Grid>
                                            </Viewbox>
                                            <ContentPresenter
                                                HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                                RecognizesAccessKey="True"
                                                SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                                        </Grid>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsFocused" Value="True" />
                                            <Trigger Property="IsDefaulted" Value="True" />
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="ellipse" Property="Opacity" Value="1" />
                                            </Trigger>
                                            <Trigger Property="IsPressed" Value="True">
                                                <Setter TargetName="ellipse" Property="Effect">
                                                    <Setter.Value>
                                                        <DropShadowEffect
                                                            BlurRadius="50"
                                                            Opacity=".75"
                                                            RenderingBias="Performance"
                                                            ShadowDepth="0"
                                                            Color="White" />
                                                    </Setter.Value>
                                                </Setter>
                                                <Setter TargetName="arrow" Property="Effect">
                                                    <Setter.Value>
                                                        <BlurEffect Radius="30" RenderingBias="Performance" />
                                                    </Setter.Value>
                                                </Setter>
                                            </Trigger>
                                            <Trigger Property="IsEnabled" Value="False" />
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Resources>
                </Button>
            </Viewbox>

            <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                <TextBlock
                    VerticalAlignment="Center"
                    Style="{DynamicResource SubTitleStyle}"
                    Text="Схема &quot;" />
                <TextBlock
                    VerticalAlignment="Center"
                    Style="{DynamicResource SubTitleStyle}"
                    Text="{Binding DeviceName}" />
                <TextBlock
                    VerticalAlignment="Center"
                    Style="{DynamicResource SubTitleStyle}"
                    Text="&quot;" />

            </StackPanel>

            <TextBlock
                Margin="50,0,0,0"
                HorizontalAlignment="Right"
                VerticalAlignment="Center"
                FontSize="14"
                Style="{DynamicResource SubTitleStyle}"
                Text="{Binding CurrentDeviceViewModel.DeviceSignature}" 
                Visibility="{Binding IsPicon2,Converter={StaticResource ObjectAsBoolToVisibilityRevertConverter}}"/>
        </StackPanel>



        <!--  Панель управления и конфигурирования  -->
        <StackPanel Grid.Row="1" Grid.Column="0">

            <Expander IsExpanded="True">
                <Expander.Header>
                    <TextBlock
                        Margin="0,5,0,0"
                        Style="{DynamicResource DialogFormHeadingStyle}"
                        Text="Управление"
                        TextAlignment="Center" />
                </Expander.Header>

                <Border BorderBrush="Gray" BorderThickness="1">
                    <StackPanel Margin="15,4">
                        <Button
                            HorizontalAlignment="Stretch"
                            Command="{Binding DeviceCommandQueueViewModel.RunNightlightCommand}"
                            Content="Включить ночное освещение"
                            Style="{StaticResource SchemeButtonStyle}" />
                        <Button
                            HorizontalAlignment="Stretch"
                            Command="{Binding DeviceCommandQueueViewModel.StopNightlightCommand}"
                            Content="Отключить ночное освещение"
                            Style="{StaticResource SchemeButtonStyle}" />

                        <Button
                            Margin="0,6,0,0"
                            HorizontalAlignment="Stretch"
                            Command="{Binding DeviceCommandQueueViewModel.RunEveningCommand}"
                            Content="Включить вечернее освещение"
                            Style="{StaticResource SchemeButtonStyle}" />
                        <Button
                            HorizontalAlignment="Stretch"
                            Command="{Binding DeviceCommandQueueViewModel.StopEveningCommand}"
                            Content="Отключить вечернее освещение"
                            Style="{StaticResource SchemeButtonStyle}" />

                        <Button
                            Margin="0,6,0,0"
                            HorizontalAlignment="Stretch"
                            Command="{Binding DeviceCommandQueueViewModel.RunFullCommand}"
                            Content="Включить полное освещение"
                            Style="{StaticResource SchemeButtonStyle}" />
                        <Button
                            HorizontalAlignment="Stretch"
                            Command="{Binding DeviceCommandQueueViewModel.StopFullCommand}"
                            Content="Отключить полное освещение"
                            Style="{StaticResource SchemeButtonStyle}" />

                        <Button
                            Margin="0,6,0,0"
                            HorizontalAlignment="Stretch"
                            Command="{Binding DeviceCommandQueueViewModel.RunBacklightCommand}"
                            Content="Включить подсветку"
                            Style="{StaticResource SchemeButtonStyle}" />
                        <Button
                            HorizontalAlignment="Stretch"
                            Command="{Binding DeviceCommandQueueViewModel.StopBacklightCommand}"
                            Content="Отключить подсветку"
                            Style="{StaticResource SchemeButtonStyle}" />

                        <Button
                            Margin="0,6,0,0"
                            HorizontalAlignment="Stretch"
                            Command="{Binding DeviceCommandQueueViewModel.RunIlluminationCommand}"
                            Content="Включить иллюминацию"
                            Style="{StaticResource SchemeButtonStyle}" />
                        <Button
                            HorizontalAlignment="Stretch"
                            Command="{Binding DeviceCommandQueueViewModel.StopIlluminationCommand}"
                            Content="Отключить иллюминацию"
                            Style="{StaticResource SchemeButtonStyle}" />
                        <Button
                            Margin="0,6,0,0"
                            HorizontalAlignment="Stretch"
                            Command="{Binding DeviceCommandQueueViewModel.RunEnergySavingCommand}"
                            Content="Включить энергосбережение"
                            Style="{StaticResource SchemeButtonStyle}" />
                        <Button
                            HorizontalAlignment="Stretch"
                            Command="{Binding DeviceCommandQueueViewModel.StopEnergySavingCommand}"
                            Content="Отключить энергосбережение"
                            Style="{StaticResource SchemeButtonStyle}" />

                        <Button
                            Margin="0,6,0,0"
                            HorizontalAlignment="Stretch"
                            Command="{Binding DeviceCommandQueueViewModel.AutoModeAllStartersCommand}"
                            Content="Авто режим все"
                            Style="{StaticResource SchemeButtonStyle}" />
                        <Button
                            Margin="0,0,0,6"
                            HorizontalAlignment="Stretch"
                            Command="{Binding DeviceCommandQueueViewModel.ManualModeAllStartersCommand}"
                            Content="Ручной режим все"
                            Style="{StaticResource SchemeButtonStyle}" />
                        <Button
                            HorizontalAlignment="Stretch"
                            Command="{Binding DeviceCommandQueueViewModel.StartRepairAllStarter}"
                            Content="Ремонт включить все"
                            Style="{StaticResource SchemeButtonStyle}" />
                        <Button
                            HorizontalAlignment="Stretch"
                            Command="{Binding DeviceCommandQueueViewModel.StopRepairAllStarter}"
                            Content="Ремонт отключить все"
                            Style="{StaticResource SchemeButtonStyle}" />
                    </StackPanel>
                </Border>
            </Expander>
            <!--  Панель управления  -->


            <Expander IsExpanded="True">
                <Expander.Header>
                    <TextBlock
                        Margin="0,15,0,0"
                        Style="{DynamicResource DialogFormHeadingStyle}"
                        Text="Конфигурирование"
                        TextAlignment="Center" />
                </Expander.Header>
                <!--  Панель конфигурирования  -->
                <StackPanel Orientation="Vertical">
                    <Border BorderBrush="Gray" BorderThickness="1">
                        <StackPanel Margin="15,4">
                            <Button
                                Margin="0,0,0,5"
                                HorizontalAlignment="Stretch"
                                Command="{Binding NavigateToConfigurationCommand}"
                                Content="Конфигурировать устройство"
                                Style="{StaticResource SchemeButtonStyle}" />
                            <Button
                                HorizontalAlignment="Stretch"
                                Command="{Binding NavigateToLightingShedulerCommand}"
                                Content="Графики"
                                Style="{StaticResource SchemeButtonStyle}" />
                            <Button
                                Margin="0,5,0,0"
                                HorizontalAlignment="Stretch"
                                Command="{Binding NavigateToInternalDeviceJournal}"
                                Content="Журнал устройства"
                                Style="{StaticResource SchemeButtonStyle}" />
                        </StackPanel>
                    </Border>


                    <!--  Кнопка вызова окна ошибок связи  -->
                    <Border
                     
                        BorderBrush="Gray"
                        BorderThickness="1">
                        <Button
                            Margin="15,4"
                            HorizontalAlignment="Stretch"
                            Command="{Binding GetConnectionErrors}"
                            Content="Ошибки связи"
                            Style="{StaticResource SchemeButtonStyle}" />
                    </Border>

                </StackPanel>
            </Expander>
        </StackPanel>


        <!--  Рубильник, показания счетчиков, Неисправности  -->
        <StackPanel Grid.Row="1" Grid.Column="2">

            <!--  Дата/Время  -->
            <TextBlock
                FontSize="18"
                Style="{DynamicResource DialogFormHeadingStyle}"
                Text="Дата/Время"
                TextAlignment="Center" />
            <Border
                Margin="0,0,0,16"
                BorderBrush="Gray"
                BorderThickness="1">
                <StackPanel Margin="15,4">
                    <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                        <TextBlock
                            FontSize="30"
                            FontWeight="Bold"
                            Text="{Binding AnalogDataViewModel.DateTimeFromDevice.Hour, Converter={StaticResource ObjAsIntToString}}"
                            TextAlignment="Center" />
                        <TextBlock
                            FontSize="30"
                            FontWeight="Bold"
                            Text=" : "
                            TextAlignment="Center" />
                        <TextBlock
                            FontSize="30"
                            FontWeight="Bold"
                            Text="{Binding AnalogDataViewModel.DateTimeFromDevice.Minute, Converter={StaticResource ObjAsIntToString}}"
                            TextAlignment="Center" />
                        <TextBlock
                            FontSize="30"
                            FontWeight="Bold"
                            Text=" : "
                            TextAlignment="Center" />
                        <TextBlock
                            FontSize="30"
                            FontWeight="Bold"
                            Text="{Binding AnalogDataViewModel.DateTimeFromDevice.Second, Converter={StaticResource ObjAsIntToString}}"
                            TextAlignment="Center" />
                    </StackPanel>
                    <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                        <TextBlock
                            FontSize="18"
                            FontWeight="DemiBold"
                            Text="{Binding AnalogDataViewModel.DateTimeFromDevice.Day, Converter={StaticResource ObjAsIntToString}}"
                            TextAlignment="Center" />
                        <TextBlock
                            FontSize="18"
                            FontWeight="DemiBold"
                            Text="."
                            TextAlignment="Center" />
                        <TextBlock
                            FontSize="18"
                            FontWeight="DemiBold"
                            Text="{Binding AnalogDataViewModel.DateTimeFromDevice.Month, Converter={StaticResource ObjAsIntToString}}"
                            TextAlignment="Center" />
                        <TextBlock
                            FontSize="18"
                            FontWeight="DemiBold"
                            Text="."
                            TextAlignment="Center" />
                        <TextBlock
                            FontSize="18"
                            FontWeight="DemiBold"
                            Text="{Binding AnalogDataViewModel.DateTimeFromDevice.Year, Converter={StaticResource ObjAsInt16ToString}}"
                            TextAlignment="Center" />
                    </StackPanel>
                    <Button
                        HorizontalAlignment="Stretch"
                        Command="{Binding DeviceCommandQueueViewModel.SetDateTimeCommand}"
                        Content="Установить время"
                        Style="{StaticResource SchemeButtonStyle}" />
                </StackPanel>
            </Border>

            <!--  Качество связи  -->
            <!--<TextBlock Style="{DynamicResource DialogFormHeadingStyle}"
                       Text="Рубильник"
                       TextAlignment="Center" />-->
            <Border BorderBrush="Gray" BorderThickness="1">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition></RowDefinition>
                        <RowDefinition></RowDefinition>
                    </Grid.RowDefinitions>
                    <TextBlock
                        Grid.Row="0"
                        Grid.Column="0"
                        FontWeight="DemiBold"
                        Text="Уровень сигнала :"
                        TextAlignment="Left" />
                    <Button
                        Grid.Row="1"
                        Grid.ColumnSpan="2"
                        HorizontalAlignment="Stretch"
                        Visibility="{Binding IsPicon2,Converter={StaticResource BoolToVisibilityConverter}}"
                        Command="{Binding  OpenPicon2ModuleInformationCommand}"
                        Content="Инф. по модулю связи"
                        Style="{StaticResource SchemeButtonStyle}"/>
                    <TextBlock
                        Grid.Row="0"
                        Grid.Column="1"
                        Text="{Binding AnalogDataViewModel.SignalLevel, Converter={StaticResource ObjAsIntToLevelSignalString}}"
                        TextAlignment="Center" />
                </Grid>
            </Border>

            <Button
                Margin="0,10,0,0"
                Command="{Binding ShowAnalogDataCommand}"
                Content="{Binding MeterType, Converter={StaticResource AnalogMeterToTextSchemeConverter}}"
                Visibility="{Binding MeterType, Converter={StaticResource AnalogMeterToVisSchemeConverter}}" />
            <Expander IsExpanded="True" Visibility="{Binding DefectStateViewModel.IsInDefinedState,Converter={StaticResource BoolToVisibilityConverter}}">
                <Expander.Header>
                    <TextBlock
                        Margin="0,10,0,0"
                        FontSize="18"
                        Style="{DynamicResource DialogFormHeadingStyle}"
                        Text="Неисправности"
                        TextAlignment="Center" />
                </Expander.Header>
                <ContentControl Content="{Binding DefectStateViewModel}"></ContentControl>
            </Expander>




            <Expander Margin="0,20,0,0" IsExpanded="True" Visibility="{Binding CustomItemsViewModel.IsSignalsEnabled,Converter={StaticResource BoolToVisibilityConverter}}">
                <Expander.Header>
                    <TextBlock
                        FontSize="18"
                        Style="{DynamicResource DialogFormHeadingStyle}"
                        Text="Сигналы"
                        TextAlignment="Center" />
                </Expander.Header>
                <Border BorderBrush="Gray" BorderThickness="1">
                    <StackPanel>
                        <ItemsControl ItemsSource="{Binding CustomItemsViewModel.SignalViewModels}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="customItems:SignalViewModel">
                                    <TextBlock
                                        FontSize="15"
                                        Foreground="{Binding State, Converter={StaticResource ObjAsBoolToStateBrushRevert}}"
                                        Text="{Binding Description}" />
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

            </Expander>




            <Expander Margin="0,20,0,0" IsExpanded="True" Visibility="{Binding CustomItemsViewModel.IsIndicatorsEnabled,Converter={StaticResource BoolToVisibilityConverter}}">
                <Expander.Header>
                    <TextBlock
                        FontSize="18"
                        Style="{DynamicResource DialogFormHeadingStyle}"
                        Text="Индикаторы"
                        TextAlignment="Center" />
                </Expander.Header>
                <Border BorderBrush="Gray" BorderThickness="1">
                    <StackPanel>
                        <ItemsControl ItemsSource="{Binding CustomItemsViewModel.IndicatorViewModels}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="customItems:IndicatorViewModel">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock
                                            Grid.Column="0"
                                            FontSize="15"
                                            Text="{Binding Description}" />
                                        <TextBlock
                                            Grid.Column="1"
                                            Margin="0,0,5,0"
                                            Text="{Binding State, Converter={StaticResource EnumStatesToTextConverter}}">
                                            <TextBlock.Foreground>
                                                <Binding Converter="{StaticResource ObjAsBoolToStateBrush}" Path="State" />
                                            </TextBlock.Foreground>
                                        </TextBlock>


                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

            </Expander>






            <Expander IsExpanded="True" Visibility="{Binding CustomItemsViewModel.IsCascadeEnabled,Converter={StaticResource BoolToVisibilityConverter}}">
                <Expander.Header>
                    <TextBlock
                        Margin="0,10,0,0"
                        FontSize="18"
                        Style="{DynamicResource DialogFormHeadingStyle}"
                        Text="Каскад"
                        TextAlignment="Center" />
                </Expander.Header>

                <Border BorderBrush="Gray" BorderThickness="1">


                    <ItemsControl
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            HorizontalContentAlignment="Center"
                            DockPanel.Dock="Top"
                            ItemsSource="{Binding Path=CustomItemsViewModel.CascadeViewModels}">

                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="customItems:CascadeViewModel">
                                <StackPanel Margin="5">
                                    <TextBlock MaxWidth="80" Text="{Binding Description}"></TextBlock>
                                    <Border
                                        Name="InnerBorder"
                                        Margin="3"
                                        Height="90"
                                        Width="40"
                                        ToolTip="{Binding Description}"
                                        Background="{Binding State, Converter={StaticResource objAsBoolToStateLimeBrush}}"
                                        BorderBrush="Gray"
                                        BorderThickness="1">
                                    </Border>
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                </Border>

            </Expander>

        </StackPanel>


        <!--  Схема устройства  -->
        <Viewbox
            Grid.Row="1"
            Grid.Column="1"
            Stretch="Fill">
            <Grid Width="800" Height="600">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="10" />
                    <ColumnDefinition />
                    <ColumnDefinition />
                    <ColumnDefinition Width="10" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="10" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="1*" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="3*" />
                    <!--<RowDefinition Height="2*" />-->
                    <!--<RowDefinition Height="1*" />-->
                </Grid.RowDefinitions>
                <!--  Рубильник  -->
                <Grid
                    Grid.Row="1"
                    Grid.Column="1"
                    Grid.ColumnSpan="2"
                    VerticalAlignment="Bottom">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="4*" />
                        <ColumnDefinition Width="1*" />
                    </Grid.ColumnDefinitions>
                    <Border
                        Grid.Column="1"
                        Height="25"
                        Margin="1,0"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Bottom"
                        Background="{Binding DefectStateViewModel.IsNoPowerDefect, Converter={StaticResource ObjAsBoolToStateBrushRevert}}"
                        BorderBrush="Black"
                        BorderThickness="1" />
                </Grid>

                <!--  Связь рубильника и пускателей  -->
                <Viewbox
                    Grid.Row="3"
                    Grid.Column="1"
                    Grid.ColumnSpan="2"
                    VerticalAlignment="Stretch"
                    Stretch="Uniform">
                    <Canvas
                        Width="800"
                        Height="140"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        Visibility="{Binding DefectStateViewModel.IsInDefinedState,Converter={StaticResource BoolToVisibilityConverter}}">
                        <Path
                            Data="M100, -2 V148"
                            Stroke="{Binding DefectStateViewModel.IsNoPowerDefect, Converter={StaticResource ObjAsBoolToStateBrushRevert}}"
                            StrokeThickness="2"
                            Visibility="{Binding BusLinkVisibleCollection[0], Converter={StaticResource BoolToVisibilityConverter}}" />
                        <Path
                            Data="M 410,-2 V148"
                            Stroke="{Binding DefectStateViewModel.IsNoPowerDefect, Converter={StaticResource ObjAsBoolToStateBrushRevert}}"
                            StrokeThickness="2"
                            Visibility="{Binding BusLinkVisibleCollection[1], Converter={StaticResource BoolToVisibilityConverter}}" />
                        <Path
                            Data="M655, -2 V148"
                            Stroke="{Binding DefectStateViewModel.IsNoPowerDefect, Converter={StaticResource ObjAsBoolToStateBrushRevert}}"
                            StrokeThickness="2"
                            Visibility="{Binding BusLinkVisibleCollection[2], Converter={StaticResource BoolToVisibilityConverter}}" />
                    </Canvas>
                </Viewbox>





                <!--  Пускатели (каналы)  -->
                <ListBox
                    Grid.Row="4"
                    Grid.Column="1"
                    Grid.ColumnSpan="2"
                    IsSelected="False"
                    HorizontalAlignment="Stretch"
                    ItemsSource="{Binding StarterViewModels}"
                    SelectionMode="Single">

                    <ListBox.Resources>
                        <Style TargetType="ListBoxItem">
                            <Style.Resources>
                                <!--  SelectedItem with focus  -->
                                <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="Transparent" />
                                <!--  SelectedItem without focus  -->
                                <SolidColorBrush x:Key="{x:Static SystemColors.ControlBrushKey}" Color="Transparent" />
                                <!--  SelectedItem text foreground  -->
                                <SolidColorBrush x:Key="{x:Static SystemColors.HighlightTextBrushKey}" Color="Black" />
                            </Style.Resources>
                            <Setter Property="FocusVisualStyle" Value="{x:Null}" />
                        </Style>
                    </ListBox.Resources>
                    <ListBox.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal" Margin="20,0,20,0" HorizontalAlignment="Stretch" VerticalAlignment="Top">
                            </StackPanel>
                        </ItemsPanelTemplate>
                    </ListBox.ItemsPanel>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="{x:Type ListBoxItem}">

                            <Setter Property="HorizontalAlignment" Value="Center" />
                            <Style.Resources>
                                <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="Transparent" />
                            </Style.Resources>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Foreground" Value="Black" />
                                </Trigger>
                                <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self },Path=DataContext.Model}" Value="{x:Null}">
                                    <Setter Property="Visibility" Value="Hidden"></Setter>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                    <ListBox.ItemTemplate>
                        <DataTemplate DataType="factories:IStarterViewModel">
                            <StackPanel Visibility="{Binding Model,Converter={StaticResource isNullToVisibilityConverter}}" Margin="25,10,25,10" Orientation="Vertical">
                                <TextBlock
                                    Width="180"
                                    MaxHeight="50"
                                    Text="{Binding StarterDescription}"
                                    TextAlignment="Center"
                                    TextWrapping="Wrap" />

                                <view:ChannelView
                                    Width="140"
                                    Height="140"
                                    Margin="20,0,20,0" />

                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>


                <!--  Шины  -->
                <Canvas
                    Grid.Row="5"
                    Grid.Column="1"
                    Grid.ColumnSpan="2"
                    HorizontalAlignment="Stretch" Margin="0,1,0,-1">


                    <Path
                        Grid.Row="0"
                        Data="M125, -2 V30 H729 M125,30 H33"
                        Stroke="{Binding StarterViewModels[0].ManagementFuseState, Converter={StaticResource ObjAsBoolToStateBrush}}"
                        StrokeThickness="2"
                        Visibility="{Binding BusLinkVisibleCollection[0], Converter={StaticResource BoolToVisibilityConverter}}" />
                    <Path
                        Grid.Row="0"
                        Data="M 380,-2 V60 H49 380,60 H740"
                        Stroke="{Binding StarterViewModels[1].ManagementFuseState, Converter={StaticResource ObjAsBoolToStateBrush}}"
                        StrokeThickness="2"
                        Visibility="{Binding BusLinkVisibleCollection[1], Converter={StaticResource BoolToVisibilityConverter}}" />
                    <Path
                        Grid.Row="0"
                        Data="M635, -2 V90 H745 M635,90 H49"
                        Stroke="{Binding StarterViewModels[2].ManagementFuseState, Converter={StaticResource ObjAsBoolToStateBrush}}"
                        StrokeThickness="2"
                        Visibility="{Binding BusLinkVisibleCollection[2], Converter={StaticResource BoolToVisibilityConverter}}" />


                    <!--  Фидеры  -->
                    <ContentControl
                        
                        Canvas.Left="30"
                        Canvas.Top="22"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Top"
                        HorizontalContentAlignment="Stretch"
                        Content="{Binding OutgoingLinesViewModel}">
                        <ContentControl.Resources>
                            <DataTemplate DataType="{x:Type outgoingLines:ResistorOutgoingLinesViewModel}">
                                <ItemsControl
                                    HorizontalAlignment="Stretch"
                                    HorizontalContentAlignment="Stretch"
                                    DockPanel.Dock="Top"
                                    ItemsSource="{Binding Path=ResistorViewModels}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Width="800" Orientation="Horizontal" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Grid>
                                                <view:ResistorView
                                                    Margin="5,0,5,0"
                                                    Width="25"
                                                    Height="200"/>
                                            </Grid>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </DataTemplate>
                            <DataTemplate DataType="{x:Type outgoingLines:FidersOutgoingLinesViewModel}">
                                <ItemsControl
                                    HorizontalAlignment="Stretch"
                                    HorizontalContentAlignment="Stretch"
                                    DockPanel.Dock="Top"
                                    ItemsSource="{Binding Path=FiderViewModels}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Width="800" Orientation="Horizontal" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate DataType="outgoingLines:FiderViewModel">
                                            <Grid>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="*"></RowDefinition>
                                                    <RowDefinition Height="Auto"></RowDefinition>
                                                </Grid.RowDefinitions>
                                                
                                                <Border BorderThickness="1" BorderBrush="#CFC0C0C0">
                                                    <ItemsControl
                                                    HorizontalAlignment="Stretch"
                                                    HorizontalContentAlignment="Stretch"
                                                    DockPanel.Dock="Top"
                                                    ItemsSource="{Binding Path=ResistorViewModels}">
                                                        <ItemsControl.ItemsPanel>
                                                            <ItemsPanelTemplate>
                                                                <StackPanel Margin="0,0,0,10" Orientation="Horizontal" />
                                                            </ItemsPanelTemplate>
                                                        </ItemsControl.ItemsPanel>
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <Grid Visibility="{Binding IsEnabled,Converter={StaticResource ObjectAsBoolToHiddenVisibilityConverter}}">
                                                                    <view:ResistorView
                                                                    Margin="5,0,5,0"
                                                                    Width="25"
                                                                    Height="200"/>
                                                                </Grid>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>

                                                </Border>
                                                <TextBlock HorizontalAlignment="Center" Grid.Row="1" Text="{Binding FiderSignature}"></TextBlock>
                                            </Grid>

                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </DataTemplate>
                        </ContentControl.Resources>
                    </ContentControl>



                    <!--<ItemsControl
                        x:Name="FidersStack"
                        Canvas.Left="20"
                        Canvas.Top="12"
                        Width="Auto"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Top"
                        HorizontalContentAlignment="Center"
                        ItemsSource="{Binding FidersWithResistorsViewModels}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate >
                                <Border
                                    Margin="10"
                                    BorderBrush="Gray"
                                    BorderThickness="1">
                                    <DockPanel Width="Auto">

                                        <ItemsControl
                                            HorizontalAlignment="Center"
                                            HorizontalContentAlignment="Center"
                                            DockPanel.Dock="Top"
                                            ItemsSource="{Binding Path=ResistorsOnFider}">


                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" />
                                                </ItemsPanelTemplate>


                                            </ItemsControl.ItemsPanel>
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid>
                                                        <view:ResistorView
                                                            Width="25"
                                                            Height="200"
                                                            Visibility="{Binding ResistorId, Converter={StaticResource ResistorsCheckBoxVisibilityConverter}}" />
                                                    </Grid>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>



                                        <TextBlock
                                            Width="Auto"
                                            DockPanel.Dock="Bottom"
                                            Text="{Binding Path=Description}"
                                            TextAlignment="Center"
                                            TextWrapping="Wrap"
                                            Visibility="{Binding Path=DescriptionVisibility}" />
                                    </DockPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>-->






                </Canvas>




            </Grid>
        </Viewbox>
    </Grid>
</UserControl>
